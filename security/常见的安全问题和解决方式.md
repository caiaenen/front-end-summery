# 常见安全问题和解决方式🍈
安全问题很重要,尤其是做支付等功能。常见的安全问题有很多,列举几种常见的是如何实现的和他们对应的解决方式。
### sql注入
#### 如何实现
非法用户在输入框中输入sql语句提交到后端，从而获取不该拿到的数据更有甚者可以修改数据库数据。
#### 解决方式
1.后端可以把前端从输入框传来的字符转义，使sql不能执行2.后端写sql时需要用占位符方式。
### xss攻击（跨站点脚本攻击）
#### 如何实现
主要是通过在导航栏或输入框输入非法的js语句并得到执行,后果是可以会获取其他用户的cookie等隐秘信息。与sql注入的区别，一个是插入js，一个是插入sql。
#### 解决方式
后端对输入需要转义处理,服务器设置httpOnly。
### csrf(cross site request fro)跨站请求伪造
#### 如何实现
跨站请求伪造，用户登录了a网址情况下，并没有登出，此时访问b网站，在b网站操作的时候，b网站伪造用户请求，从而实现在站b操作，但是，影响了站a网址。后果可能是用户在不知情情况下，在站a提交了数据。
#### 解决方式
用token提交，在网站重要提交处，加上验证码校验，cookie设置samesite属性。（strict或lax都可）

CSRF 攻击指的是跨站请求伪造攻击，攻击者诱导用户进入一个第三方网站，然后该网站向被攻击网站发送跨站请求。如果用户在被
攻击网站中保存了登录状态，那么攻击者就可以利用这个登录状态，绕过后台的用户验证，冒充用户向服务器执行一些操作。

CSRF 攻击的本质是利用了 cookie 会在同源请求中携带发送给服务器的特点，以此来实现用户的冒充。

一般的 CSRF 攻击类型有三种：

第一种是 GET 类型的 CSRF 攻击，比如在网站中的一个 img 标签里构建一个请求，当用户打开这个网站的时候就会自动发起提
交。

第二种是 POST 类型的 CSRF 攻击，比如说构建一个表单，然后隐藏它，当用户进入页面时，自动提交这个表单。

第三种是链接类型的 CSRF 攻击，比如说在 a 标签的 href 属性里构建一个请求，然后诱导用户去点击。

CSRF 可以用下面几种方法来防护：

第一种是同源检测的方法，服务器根据 http 请求头中 origin 或者 referer 信息来判断请求是否为允许访问的站点，从而对请求进行过滤。当 origin 或者 referer 信息都不存在的时候，直接阻止。这种方式的缺点是有些情况下 referer 可以被伪造。还有就是我们这种方法同时把搜索引擎的链接也给屏蔽了，所以一般网站会允许搜索引擎的页面请求，但是相应的页面请求这种请求方式也可能被攻击者给利用。

第二种方法是使用 CSRF Token 来进行验证，服务器向用户返回一个随机数 Token ，当网站再次发起请求时，在请求参数中加入服务器端返回的 token ，然后服务器对这个 token 进行验证。这种方法解决了使用 cookie 单一验证方式时，可能会被冒用的问题，但是这种方法存在一个缺点就是，我们需要给网站中的所有请求都添加上这个 token，操作比较繁琐。还有一个问题是一般不会只有一台网站服务器，如果我们的请求经过负载平衡转移到了其他的服务器，但是这个服务器的 session 中没有保留这个 token 的话，就没有办法验证了。这种情况我们可以通过改变 token 的构建方式来解决。

第三种方式使用双重 Cookie 验证的办法，服务器在用户访问网站页面时，向请求域名注入一个Cookie，内容为随机字符串，然后当用户再次向服务器发送请求的时候，从 cookie 中取出这个字符串，添加到 URL 参数中，然后服务器通过对 cookie 中的数据和参数中的数据进行比较，来进行验证。使用这种方式是利用了攻击者只能利用 cookie，但是不能访问获取 cookie 的特点。并且这种方法比 CSRF Token 的方法更加方便，并且不涉及到分布式访问的问题。这种方法的缺点是如果网站存在 XSS 漏洞的，那么这种方式会失效。同时这种方式不能做到子域名的隔离。

第四种方式是使用在设置 cookie 属性的时候设置 Samesite ，限制 cookie 不能作为被第三方使用，从而可以避免被攻击者利用。Samesite 一共有两种模式，一种是严格模式，在严格模式下 cookie 在任何情况下都不可能作为第三方 Cookie 使用，在宽松模式下，cookie 可以被请求是 GET 请求，且会发生页面跳转的请求所使用。

### 点击劫持
#### 如何实现
点击劫持，被别的安全网站iframe，遮挡住页面且出现本不该有的弹框，点击后去不安全的网址或者提交不应该的请求。
#### 解决方式
始终让自己的document在页面的最上层，否则跳回原来url，使之不会被iframe。使用iframe的sandbox属性，判断当前页面是否被其他页面嵌套。设置X-Frame-Options为deny或sameorigin。